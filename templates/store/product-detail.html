{% extends 'base.html' %}
{% load static %}

{% block content %}


<section class="section-content padding-y bg">
<div class="container">

<!-- ============================ COMPONENT 1 ================================= -->
<div class="card">
	<div class="row no-gutters">
		<aside class="col-md-6">
<article class="gallery-wrap"> 
	<div class="img-big-wrap mainImage">
		{% if single_product.images.first %}
			<center><img id="mainImage" src="{{ single_product.images.first.image.url }}" alt="{{ single_product.images.first.alt_text }}"></center>
		{% else %}
			<center><img src="{% static 'images/default-product.png' %}" alt="No image available"></center>	
	   {% endif %}
	</div> <!-- img-big-wrap.// -->
	<ul class="thumb">
		<li>
			{% for i in single_product_images %}
    		<a href="{{ i.image.url }}" class="img-fluid img-xs img-thumbnail" target="mainImage">
        	<img src="{{ i.image.url }}" alt="{{ i.alt_text }}" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">
    		</a>
			{% endfor %}
		</li>
	</ul> 
			
</article>
					<!-- gallery-wrap .end// -->
					 
		</aside>
		
		<main class="col-md-6 border-left">
<form id="addToCartForm" action="{% url 'add_to_cart' single_product.id %}" method="POST">
	{% csrf_token %}
	<article class="content-body">
		<h2 class="title">{{ single_product.title }}</h2>
			<div class="rating-star text-warning mb-3">

			{% if single_product.average_rating %}
				<span>
				<i class="fa fa-star{% if single_product.average_rating < 0.5 %}-o{% elif single_product.average_rating >= 0.5 and single_product.average_rating < 1 %}-half-o {% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.average_rating < 1.5 %}-o{% elif single_product.average_rating >= 1.5 and single_product.average_rating < 2 %}-half-o {% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.average_rating < 2.5 %}-o{% elif single_product.average_rating >= 2.5 and single_product.average_rating < 3 %}-half-o {% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.average_rating < 3.5 %}-o{% elif single_product.average_rating >= 3.5 and single_product.average_rating < 4 %}-half-o {% endif %}" aria-hidden="true"></i>
				<i class="fa fa-star{% if single_product.average_rating < 4.5 %}-o{% elif single_product.average_rating >= 4.5 and single_product.average_rating < 5 %}-half-o {% endif %}" aria-hidden="true"></i>
				<!-- <span>{{single_product.countReview}} reviews</span> -->
				</span>
				<span class="text-muted"> {{ single_product.review_count }} 
					{% if single_product.review_count|add:'-1' == 0 %}review {% else %}reviews{% endif %}
				</span>
			{% else %}
				<span class="text-muted"> No reviews yet </span>	
			{% endif %}
			<span class="text-success fw-medium float-md-right"> {{ single_product.order_count }} sold </span>

			</div>

			<div class="mb-3">
			{% if single_product.discounted_price %}
			<div>
				{% if single_product.discounted_price < single_product.price %}
				<del class="price-old">Rs. {{single_product.price}}</del>
				{% endif %}
				<var class="price h4 text-warning">Rs. {{single_product.discounted_price}}</var>
				{% else %}
				<var class="price h4">Rs. {{single_product.price}}</var>
				{% endif %}
				{% if single_product.short_description %}
				<p class="text-muted mt-2">{{ single_product.short_description|safe }}</p>
				{% endif %}
			</div>
	
<hr>
{% if single_product.is_variant %}
    {% regroup single_product_variations by variation_type as variant_groups %}
    {% for group in variant_groups %}
        <h2>{{ group.grouper|capfirst }}</h2>
        <div class="item-option-select">
            <h6>Choose {{ group.grouper|capfirst }}</h6>
            <div class="btn-group btn-group-sm btn-group-toggle" data-toggle="buttons">
                {% for variant in group.list %}
                    {% if group.grouper == 'color' %}
                        <label class="btn btn-light" for="color_{{ variant.id }}" style="margin-right: 5px;">
                            <input type="radio" name="color" id="color_{{ variant.id }}" value="{{ variant.id }}">
                            <span style="display:inline-block; width:20px; height:20px; background-color:{{ variant.color.hex_code }}; border-radius:50%; border:1px solid #ccc; vertical-align:middle; margin-right:5px;"></span>
                            {{ variant.color.name|capfirst }}
                            <img src="{{ variant.image.url }}" alt="{{ variant.color.name|capfirst }}" style="width: 30px; height: 30px; border-radius: 50%; margin-left: 5px;">
                        </label>
                    {% elif group.grouper == 'size' %}
                        <label class="btn btn-light" for="size_{{ variant.id }}" style="margin-right: 5px;">
                            <input type="radio" name="size" id="size_{{ variant.id }}" value="{{ variant.id }}">
                            {{ variant.size.name|capfirst }}
                            <img src="{{ variant.image.url }}" alt="{{ variant.size.name|capfirst }}" style="width: 30px; height: 30px; border-radius: 50%; margin-left: 5px;">
                        </label>
                    {% elif group.grouper == 'flavor' %}
                        <label class="btn btn-light" for="flavor_{{ variant.id }}" style="margin-right: 5px;">
                            <input type="radio" name="flavor" id="flavor_{{ variant.id }}" value="{{ variant.id }}">
                            {{ variant.flavor.name|capfirst  }} 
                            <img src="{{ variant.image.url }}" alt="{{ variant.flavor.name|capfirst }}" style="width: 30px; height: 30px; border-radius: 50%; margin-left: 5px;">
                        </label>
                    {% endif %}
                    <script>
document.addEventListener('DOMContentLoaded', function () {
    const groups = ['color', 'size', 'flavor'];

    groups.forEach(group => {
        const radios = document.querySelectorAll(`input[name="${group}"]`);
        radios.forEach(radio => {
            radio.addEventListener('change', function () {
                // Remove 'active' from all labels in this group
                radios.forEach(r => {
                    const label = document.querySelector(`label[for="${r.id}"]`);
                    if (label) label.classList.remove('active');
                });

                // Add 'active' to selected label
                const selectedLabel = document.querySelector(`label[for="${this.id}"]`);
                if (selectedLabel) selectedLabel.classList.add('active');
            });
        });
    });
});
</script>

                {% endfor %}
            </div>
        </div>
    {% endfor %}
   
    
{% endif %}
								

<hr>
	{% if single_product.stock <= 0 %}
		<h5 class="text-danger">Out of Stock</h5>
	{% else %}
		<button type="submit" id="addToCartBtn" class="btn btn-primary"> <span class="text">Add to Cart</span> <i class="fas fa-shopping-cart"></i> </button>
        {% include 'includes/alerts.html' %}

	{% endif %}
</article> <!-- product-info-aside .// -->
</form>


		</main> <!-- col.// -->
	</div> <!-- row.// -->
</div> <!-- card.// -->
<!-- ============================ COMPONENT 1 END .// ================================= -->

<br>

<div class="row">
			<div class="col-md-9">
				<div class="blog-content">
				{{ single_product.description | safe }}			
			</div>


    <form method="POST" action="{% url 'submit_review' single_product.id %}">
        {% csrf_token %}
        <h5>Write your review</h5>
        <div>
						<!-- Rating stars -->
						<label>How do you rate this product?</label>
						<br>
						<div class="rate">
							<input type="radio" name="rating" id="rating10" value="5" required /><label for="rating10" title="5"></label>
							<input type="radio" name="rating" id="rating9" value="4.5" required /><label for="rating9" title="4.5" class="half"></label>
							<input type="radio" name="rating" id="rating8" value="4" required /><label for="rating8" title="4"></label>
							<input type="radio" name="rating" id="rating7" value="3.5" required /><label for="rating7" title="3.5" class="half"></label>
							<input type="radio" name="rating" id="rating6" value="3" required /><label for="rating6" title="3"></label>
							<input type="radio" name="rating" id="rating5" value="2.5" required /><label for="rating5" title="2.5" class="half"></label>
							<input type="radio" name="rating" id="rating4" value="2" required /><label for="rating4" title="2"></label>
							<input type="radio" name="rating" id="rating3" value="1.5" required /><label for="rating3" title="1.5" class="half"></label>
							<input type="radio" name="rating" id="rating2" value="1" required /><label for="rating2" title="1"></label>
							<input type="radio" name="rating" id="rating1" value="0.5" required /><label for="rating1" title="0.5" class="half"></label>
						</div>
<br>
						Review Title:
						<input type="text" class="form-control" name="subject">
						<br>
						Review:
						<textarea name="review" rows="4" class="form-control"></textarea>
						<br>
						{% if user.is_authenticated %}
							{% if orderproduct %}
								<input type="submit" value="Submit Review" class="btn btn-primary">
							{% else %}
								<p>You must purchase this product to post a review.</p>
							{% endif %}
						{% else %}
						<p>You must be logged in to post a review. <span><a href="{% url 'login' %}">Login now</a></span></p>
						{% endif %}

					</div>
            {% include 'includes/alerts.html' %}
        
    </form>
	<br>
<header class="section-heading">
	<h3>Customer Reviews </h3>
	<div class="rating-star">
		<span>
			<i class="fa fa-star{% if single_product.average_rating < 0.5 %}-o{% elif single_product.average_rating >= 0.5 and single_product.average_rating < 1 %}-half-o {% endif %}" aria-hidden="true"></i>
			<i class="fa fa-star{% if single_product.average_rating < 1.5 %}-o{% elif single_product.average_rating >= 1.5 and single_product.average_rating < 2 %}-half-o {% endif %}" aria-hidden="true"></i>
			<i class="fa fa-star{% if single_product.average_rating < 2.5 %}-o{% elif single_product.average_rating >= 2.5 and single_product.average_rating < 3 %}-half-o {% endif %}" aria-hidden="true"></i>
			<i class="fa fa-star{% if single_product.average_rating < 3.5 %}-o{% elif single_product.average_rating >= 3.5 and single_product.average_rating < 4 %}-half-o {% endif %}" aria-hidden="true"></i>
			<i class="fa fa-star{% if single_product.average_rating < 4.5 %}-o{% elif single_product.average_rating >= 4.5 and single_product.average_rating < 5 %}-half-o {% endif %}" aria-hidden="true"></i>
	<span>{{single_product.review_count}} 
		{% if single_product.review_count|add:'-1' == 0 %}review {% else %}reviews{% endif %}
	</span>
			<span class="text-success fw-medium float-md-right"> {{ single_product.order_count }} sold </span>
	</div>

</header>

{% for review in reviews %}
				<article class="box mb-3">
					<div class="icontext w-100">

						<div class="text">
							<span class="date text-muted float-md-right">{{review.updated_at}} </span>
							<h6 class="mb-1">{{review.user.full_name}} </h6>
							<div class="rating-star">
								<span>
									<i class="fa fa-star{% if review.rating == 0.5 %}-half-o{% elif review.rating < 1 %}-o {% endif %}" aria-hidden="true"></i>
									<i class="fa fa-star{% if review.rating == 1.5 %}-half-o{% elif review.rating < 2 %}-o {% endif %}" aria-hidden="true"></i>
									<i class="fa fa-star{% if review.rating == 2.5 %}-half-o{% elif review.rating < 3 %}-o {% endif %}" aria-hidden="true"></i>
									<i class="fa fa-star{% if review.rating == 3.5 %}-half-o{% elif review.rating < 4 %}-o {% endif %}" aria-hidden="true"></i>
									<i class="fa fa-star{% if review.rating == 4.5 %}-half-o{% elif review.rating < 5 %}-o {% endif %}" aria-hidden="true"></i>
								</span>
							</div>
						</div>
					</div> <!-- icontext.// -->
					<div class="mt-3">
						<h6>{{review.subject}}</h6>
						<p>
							{{review.review}}
						</p>
					</div>
				</article>

{% endfor %}
	

	</div> <!-- col.// -->
</div> <!-- row.// -->


</div> <!-- container .//  -->
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->



{% endblock %}

